<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>登录</title>
		<style type="text/css">
			.form-sub1 {
				margin-top: 10px;
				margin-bottom: 10px;
			}
		</style>
		<script type="text/javascript" src="./js/utils.js"></script>
	</head>
	<body>
		<form action="/JavaEE/user?method=login" method="post">
			<div class="form-sub1" id="check-username">
				<label for="username">用户名：</label>
				<input type="text" required="required" name="username" value="" id="username" />
			</div>
			<div class="form-sub1">
				<label for="password">登录密码：</label>
				<input type="password" required="required" name="password" value="" id="password" />
			</div>
			<div class="form-sub1">
				<input type="submit" value="提交" />
			</div>
		</form>
		<script type="text/javascript">
			//异步校验用户名是否存在
			Utils.on(document.getElementById("username"), "blur", function() {
				var node = '';
				if (Utils.strIsBlank(this.value)) {
					node = document.createTextNode("请输入正确的用户名。");
					checkNameTip(node);
				} else {
					//异步校验
					Utils.async("post", {
						username: this.value
					}, "/JavaEE/user?method=checkName", function(data) {
						if(200!=data.code){
							node = document.createTextNode(data.msg);
							checkNameTip(node);
						}
					}, true,'json');
				}

			});

			function checkNameTip(node) {
				//创建元素，并显示
				var newSubE = document.createElement("b");
				newSubE.style = 'color: red;';
				newSubE.appendChild(node);

				var parentE = document.getElementById("check-username");
				var exitSubE = document.getElementById("username");
				parentE.appendChild(newSubE, exitSubE);

				//1s删除新创建的元素
				setTimeout(function() {
					parentE.removeChild(newSubE);
				}, 1500);
			}
		</script>
	</body>
</html>
